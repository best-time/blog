{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{580:function(e,a,s){\"use strict\";s.r(a);var t=s(12),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[s(\"h3\",{attrs:{id:\"包下载的前置知识\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#包下载的前置知识\"}},[e._v(\"#\")]),e._v(\" 包下载的前置知识\")]),e._v(\" \"),s(\"p\",[e._v(\"一个包的版本号基本由三位数字构成 \"),s(\"code\",[e._v(\"x.x.x\")]),e._v(\", 它们分别是 \"),s(\"code\",[e._v(\"Major\")]),e._v(\"(主版本号), \"),s(\"code\",[e._v(\"Minor\")]),e._v(\"(次版本号), \"),s(\"code\",[e._v(\"Patch\")]),e._v(\"(修订号)。\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[s(\"code\",[e._v(\"*\")]),e._v(\": 升级 \"),s(\"code\",[e._v(\"Major\")]),e._v(\" + \"),s(\"code\",[e._v(\"Minor\")]),e._v(\" + \"),s(\"code\",[e._v(\"Patch\")]),e._v(\";\")]),e._v(\" \"),s(\"li\",[s(\"code\",[e._v(\"^\")]),e._v(\": 升级 \"),s(\"code\",[e._v(\"Minor\")]),e._v(\" + \"),s(\"code\",[e._v(\"Patch\")]),e._v(\";\")]),e._v(\" \"),s(\"li\",[s(\"code\",[e._v(\"~\")]),e._v(\": 升级 \"),s(\"code\",[e._v(\"Patch\")]),e._v(\";\")])]),e._v(\" \"),s(\"p\",[e._v(\"比如 \"),s(\"code\",[e._v(\"^4.3.1 表示 4.x.x\")]),e._v(\" 的最新版, \"),s(\"code\",[e._v(\"~4.3.1 表示 4.3.x\")]),e._v(\" 的最新版。\")]),e._v(\" \"),s(\"h3\",{attrs:{id:\"npm\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#npm\"}},[e._v(\"#\")]),e._v(\" npm\")]),e._v(\" \"),s(\"p\",[s(\"code\",[e._v(\"npm\")]),e._v(\" 经历了 3 次升级:\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[s(\"code\",[e._v(\"npm1\")]),e._v(\": 嵌套结构\")])]),e._v(\" \"),s(\"p\",[e._v(\"缺点: 相同的包会被重复下载多次, 比如下列 a、b、c 都依赖了 xxx 这个包, xxx 这个包被下载了 3 次。\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v(\"-node-modules\\n  - a\\n    - node-modules\\n      - xxx @1.0.0\\n  - b\\n    - node-modules\\n      - xxx @1.0.0\\n  - c\\n    - node-modules\\n      - xxx @1.0.1\\n\")])])]),s(\"ul\",[s(\"li\",[s(\"code\",[e._v(\"npm3\")]),e._v(\": 扁平结构\")])]),e._v(\" \"),s(\"p\",[e._v(\"所依赖的包的依赖也安装于根目录, 如果所依赖的包的依赖在根目录已存在但是版本不一致, 则在所依赖的包下面单独加上依赖的包。例子如下:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v(\"-node-modules\\n- a\\n- b\\n- xxx @1.0.0\\n- c\\n  - node-modules\\n    - xxx @1.0.1\\n\")])])]),s(\"ul\",[s(\"li\",[s(\"code\",[e._v(\"npm5\")]),e._v(\": 扁平结构 + package-lock.json\")])]),e._v(\" \"),s(\"p\",[e._v(\"加上锁文件, 确保在不同电脑上安装的包的版本号相同。\")]),e._v(\" \"),s(\"h3\",{attrs:{id:\"yarn\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#yarn\"}},[e._v(\"#\")]),e._v(\" yarn\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[e._v(\"更快, 离线缓存\")]),e._v(\" \"),s(\"li\",[e._v(\"yarn.lock 文件\")])]),e._v(\" \"),s(\"h4\",{attrs:{id:\"yarn-和-npm5-的区别\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#yarn-和-npm5-的区别\"}},[e._v(\"#\")]),e._v(\" yarn 和 npm5 的区别\")]),e._v(\" \"),s(\"h5\",{attrs:{id:\"同\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#同\"}},[e._v(\"#\")]),e._v(\" 同\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[s(\"code\",[e._v(\"npm\")]),e._v(\" 通过 \"),s(\"code\",[e._v(\"package-lock.json\")]),e._v(\" 推断出 \"),s(\"code\",[e._v(\"node_modules\")]),e._v(\" 目录\")]),e._v(\" \"),s(\"li\",[s(\"code\",[e._v(\"yarn\")]),e._v(\" 也能通过 \"),s(\"code\",[e._v(\"yarn.lock\")]),e._v(\" 文件推断出 \"),s(\"code\",[e._v(\"node_modules\")]),e._v(\" 顶层目录的。就是要通过稍微计算, 比如下方:\")])]),e._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"// yarn 的 yarn.lock 类似如下\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" a\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" b\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" c\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" xxx@\"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"1.0\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\".1\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" xxx@\"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"1.0\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\".1\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" xxx@\"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"1.0\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\".0\")]),e._v(\"\\n\")])])]),s(\"p\",[e._v(\"这个例子中, 我们能得出顶层目录如下:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"// node_modules\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" a\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" b\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" c\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"-\")]),e._v(\" xxx@\"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"1.0\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\".0\")]),e._v(\"\\n\")])])]),s(\"h5\",{attrs:{id:\"异\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#异\"}},[e._v(\"#\")]),e._v(\" 异\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[e._v(\"依赖于 \"),s(\"code\",[e._v(\"yarn\")]),e._v(\" 的缓存机制(类似 \"),s(\"code\",[e._v(\"cnpm\")]),e._v(\" 的引用机制？), \"),s(\"code\",[e._v(\"yarn\")]),e._v(\" 的安装速度更快, 甚至能离线加载;\")])]),e._v(\" \"),s(\"p\",[e._v(\"也就是说 \"),s(\"code\",[e._v(\"yarn\")]),e._v(\" 结合了 \"),s(\"code\",[e._v(\"npm\")]),e._v(\" 和 \"),s(\"code\",[e._v(\"cnpm\")]),e._v(\" 的优点。\")]),e._v(\" \"),s(\"h4\",{attrs:{id:\"hooks-踩坑\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#hooks-踩坑\"}},[e._v(\"#\")]),e._v(\" Hooks 踩坑\")]),e._v(\" \"),s(\"p\",[e._v(\"There are three common reasons you might be seeing it:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"1.\")]),e._v(\" You might have mismatching versions \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[e._v(\"of\")]),e._v(\" React and React \"),s(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[e._v(\"DOM\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\".\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"2.\")]),e._v(\" You might be breaking the Rules \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[e._v(\"of\")]),e._v(\" Hooks\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\".\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"3.\")]),e._v(\" You might have more than one copy \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[e._v(\"of\")]),e._v(\" React \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[e._v(\"in\")]),e._v(\" the same app\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\".\")]),e._v(\"\\n\")])])]),s(\"p\",[e._v('在 demo 项目中使用 yarn link \"@msfe/beast-mobile\" 会遇到上述报错, 解决方法是执行(貌似有问题)')]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"npm\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"link\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"..\")]),e._v(\"/beast-mobile-demo/node_modules/react from @msfe/beast-mobile\\n\")])])]),s(\"p\",[e._v(\"另一种方法是在业务项目中配置 \"),s(\"a\",{attrs:{href:\"https://yarnpkg.com/lang/en/docs/selective-version-resolutions/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"resolutions\"),s(\"OutboundLink\")],1)]),e._v(\" \"),s(\"p\",[e._v(\"try \"),s(\"a\",{attrs:{href:\"https://github.com/whitecolor/yalc\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"yalc\"),s(\"OutboundLink\")],1)]),e._v(\" \"),s(\"h3\",{attrs:{id:\"区分几个-package-json-字段\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#区分几个-package-json-字段\"}},[e._v(\"#\")]),e._v(\" 区分几个 package.json 字段\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[e._v(\"dependencies: 业务依赖\")]),e._v(\" \"),s(\"li\",[e._v(\"devDependencies: 开发依赖\")]),e._v(\" \"),s(\"li\",[e._v(\"peerDependencies:\\n\"),s(\"ul\",[s(\"li\",[e._v(\"a 依赖了 b 包, b 包的 peerDependencies 字段含有 c 包。\\n\"),s(\"ul\",[s(\"li\",[e._v(\"b 包执行 yarn 此时并不会安装上 c 包。\")]),e._v(\" \"),s(\"li\",[e._v(\"如果 a 包中未执行安装 c 包, 则会报错。\")])])])])])]),e._v(\" \"),s(\"h3\",{attrs:{id:\"resolutions-in-package-json\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#resolutions-in-package-json\"}},[e._v(\"#\")]),e._v(\" resolutions in package.json\")]),e._v(\" \"),s(\"p\",[e._v(\"背景: 在项目中的 package.json 字段里 dependencies 字段有较新版本的 beast-mobile(带主题包), resolutions 指向了较低版本的 beast-mobile(不带主题包)。此时验证项目中包含主题包。\")]),e._v(\" \"),s(\"p\",[e._v(\"查找 yarn 的 \"),s(\"a\",{attrs:{href:\"https://github.com/yarnpkg/rfcs/blob/master/implemented/0000-selective-versions-resolutions.md#package-designation\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"rfc\"),s(\"OutboundLink\")],1),e._v(\", resolutions 指定的目录只针对「嵌套」依赖的包版本生效。\")])])}),[],!1,null,null,null);a.default=n.exports}}]);","extractedComments":[]}