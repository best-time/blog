{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[248],{787:function(t,s,e){\"use strict\";e.r(s);var a=e(12),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[e(\"h3\",{attrs:{id:\"suspense-设计模式\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#suspense-设计模式\"}},[t._v(\"#\")]),t._v(\" Suspense 设计模式\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[e(\"code\",[t._v(\"fetch on render\")]),t._v(\": 目前一般数据获取写在 componentDidMount 阶段, 其获取数据的过程中, 执行顺序如下所示:\")])]),t._v(\" \"),e(\"ol\",[e(\"li\",[t._v(\"start fetchA\")]),t._v(\" \"),e(\"li\",[t._v(\"...\"),e(\"code\",[t._v(\"wait Time1\")]),t._v(\"...\")]),t._v(\" \"),e(\"li\",[t._v(\"finish fetchA\")]),t._v(\" \"),e(\"li\",[t._v(\"start fetchB\")]),t._v(\" \"),e(\"li\",[t._v(\"...\"),e(\"code\",[t._v(\"wait Time2\")]),t._v(\"...\")]),t._v(\" \"),e(\"li\",[t._v(\"finish fetchB\")])]),t._v(\" \"),e(\"p\",[t._v(\"这么做存在的问题: 在 B 组件中开始请求数据时至少要等上 \"),e(\"code\",[t._v(\"Time1\")]),t._v(\" 时间, 是一种 \"),e(\"code\",[t._v(\"network waterfall\")]),t._v(\" 而非\"),e(\"code\",[t._v(\"并发请求\")]),t._v(\";\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[e(\"code\",[t._v(\"fetch then render\")]),t._v(\": \"),e(\"code\",[t._v(\"调用 setState 之前先获取数据\")]),t._v(\", 比如在 A 组件的 componentDidMount 中使用 \"),e(\"code\",[t._v(\"Promise.all()\")]),t._v(\" 同时执行 \"),e(\"code\",[t._v(\"fetchA, fetchB\")])])]),t._v(\" \"),e(\"ol\",[e(\"li\",[t._v(\"start fetchA\")]),t._v(\" \"),e(\"li\",[t._v(\"start fetchB\")]),t._v(\" \"),e(\"li\",[t._v(\"finish fetchA\")]),t._v(\" \"),e(\"li\",[t._v(\"finish fetchB\")]),t._v(\" \"),e(\"li\",[e(\"code\",[t._v(\"render\")])])]),t._v(\" \"),e(\"p\",[t._v(\"这么做存在的问题: A 组件和 B 组件上的数据显示时间取决于请求时间更长的接口, 所以\"),e(\"code\",[t._v(\"页面上渲染数据必然会存在延时\")]),t._v(\";\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[e(\"code\",[t._v(\"render as fetch\")]),t._v(\": 使用 Suspense 后的效果呢?\")])]),t._v(\" \"),e(\"ol\",[e(\"li\",[t._v(\"start fetchA\")]),t._v(\" \"),e(\"li\",[t._v(\"start fetchB\")]),t._v(\" \"),e(\"li\",[e(\"code\",[t._v(\"render\")])]),t._v(\" \"),e(\"li\",[t._v(\"finish fetchA\")]),t._v(\" \"),e(\"li\",[t._v(\"finish fetchB\")])]),t._v(\" \"),e(\"p\",[t._v(\"它很好地规避了上述遇到的两个问题:\")]),t._v(\" \"),e(\"ol\",[e(\"li\",[t._v(\"解决接口根据 render 走导致\"),e(\"code\",[t._v(\"不能并发请求接口\")]),t._v(\"的痛点;\")]),t._v(\" \"),e(\"li\",[t._v(\"解决使用 Promise.all 带来的\"),e(\"code\",[t._v(\"页面数据内容存在延时\")]),t._v(\"的问题;\")])]),t._v(\" \"),e(\"h3\",{attrs:{id:\"concurrent-ui-patterns\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#concurrent-ui-patterns\"}},[t._v(\"#\")]),t._v(\" Concurrent UI patterns\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[e(\"code\",[t._v(\"Default Mode\")]),t._v(\": Receded → Skeleton → Complete\")]),t._v(\" \"),e(\"li\",[e(\"code\",[t._v(\"Preferred Mode\")]),t._v(\": Pending → Skeleton → Complete\")])]),t._v(\" \"),e(\"p\",[t._v(\"总结:\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[t._v(\"Receded 不好的原因是因为其把页面现有的内容给弄丢了。\")]),t._v(\" \"),e(\"li\",[t._v(\"可以使用 \"),e(\"code\",[t._v(\"useTransition\")]),t._v(\" 进入 Pending 状态 —— 位于当前页的同时, 加载下一页(想象多元宇宙)\")]),t._v(\" \"),e(\"li\",[t._v(\"如果不想下一个页面的非核心组件延长 Pending 的时间, 用 Suspense 包裹它;\")])]),t._v(\" \"),e(\"h3\",{attrs:{id:\"usedeferredvalue\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#usedeferredvalue\"}},[t._v(\"#\")]),t._v(\" useDeferredValue\")]),t._v(\" \"),e(\"p\",[e(\"code\",[t._v(\"useDeferredValue\")]),t._v(\" 的作用: 能让组件中的部分内容\"),e(\"code\",[t._v(\"延迟加载\")]),t._v(\"。\")]),t._v(\" \"),e(\"div\",{staticClass:\"language-js extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" deferredText \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"useDeferredValue\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"text\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  timeoutMs\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\":\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"5000\")]),t._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),e(\"p\",[t._v(\"这里第二个参数表示, 能确保 5s 之内输入框内的输入是顺滑的。\")]),t._v(\" \"),e(\"h3\",{attrs:{id:\"suspenselist\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#suspenselist\"}},[t._v(\"#\")]),t._v(\" SuspenseList\")]),t._v(\" \"),e(\"p\",[t._v(\"SuspenseList 中的 \"),e(\"code\",[t._v(\"revealOrder\")]),t._v(\" 字段能控制其里面 Suspense 节点的输出顺序, \"),e(\"code\",[t._v(\"tail\")]),t._v(\" 字段控制当前加载的节点数。\")]),t._v(\" \"),e(\"div\",{staticClass:\"language-js extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"ProfilePage\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token parameter\"}},[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" resource \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")])]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"SuspenseList revealOrder\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"forwards\"')]),t._v(\" tail\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"collapsed\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n      \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"ProfileDetails resource\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"resource\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n      \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"Suspense fallback\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"h2\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"Loading posts\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"h2\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"ProfileTimeline resource\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"resource\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n      \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"Suspense\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n      \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"Suspense fallback\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"h2\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"Loading fun facts\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"h2\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"ProfileTrivia resource\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"resource\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n      \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"Suspense\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"SuspenseList\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);","extractedComments":[]}