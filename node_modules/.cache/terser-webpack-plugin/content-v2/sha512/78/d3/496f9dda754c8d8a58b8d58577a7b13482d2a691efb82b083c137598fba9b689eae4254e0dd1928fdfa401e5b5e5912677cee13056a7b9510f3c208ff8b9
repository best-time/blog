{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[312],{851:function(t,s,a){\"use strict\";a.r(s);var r=a(12),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"探寻-javascript-精度问题\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#探寻-javascript-精度问题\"}},[t._v(\"#\")]),t._v(\" 探寻 JavaScript 精度问题\")]),t._v(\" \"),a(\"p\",[t._v(\"阅读完本文可以了解到 \"),a(\"code\",[t._v(\"0.1 + 0.2\")]),t._v(\" 为什么等于 \"),a(\"code\",[t._v(\"0.30000000000000004\")]),t._v(\" 以及 JavaScript 中最大安全数是如何来的。\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"十进制小数转为二进制小数方法\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#十进制小数转为二进制小数方法\"}},[t._v(\"#\")]),t._v(\" 十进制小数转为二进制小数方法\")]),t._v(\" \"),a(\"p\",[t._v(\"拿 173.8125 举例如何将之转化为二进制小数。\")]),t._v(\" \"),a(\"p\",[t._v(\"①. 针对整数部分 173, 采取\"),a(\"code\",[t._v(\"除 2 取余, 逆序排列\")]),t._v(\";\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-js extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"173\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"86\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"86\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"43\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"43\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"21\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"   ↑\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"21\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"10\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"|\")]),t._v(\" 逆序排列\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"10\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"5\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),t._v(\"    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"|\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"5\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"     \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"|\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"得整数部分的二进制为 \"),a(\"code\",[t._v(\"10101101\")]),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"②. 针对小数部分 0.8125, 采用\"),a(\"code\",[t._v(\"乘 2 取整, 顺序排列\")]),t._v(\";\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-js extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.8125\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1.625\")]),t._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"|\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.625\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1.25\")]),t._v(\"    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"|\")]),t._v(\" 顺序排列\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.25\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.5\")]),t._v(\"      \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"|\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.5\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"         ↓\\n\")])])]),a(\"p\",[t._v(\"得小数部分的二进制为 \"),a(\"code\",[t._v(\"1101\")]),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"③. 将前面两部的结果相加, 结果为 \"),a(\"code\",[t._v(\"10101101.1101\")]),t._v(\";\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"小心-二进制小数丢失了精度\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#小心-二进制小数丢失了精度\"}},[t._v(\"#\")]),t._v(\" 小心, 二进制小数丢失了精度！\")]),t._v(\" \"),a(\"p\",[t._v(\"根据上面的知识, 将十进制小数 \"),a(\"code\",[t._v(\"0.1\")]),t._v(\" 转为二进制:\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-js extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.1\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.2\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.4\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 注意这里\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.4\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.8\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.8\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1.6\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.6\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1.2\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.4\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 注意这里, 循环开始\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.4\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.8\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.8\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1.6\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.6\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1.2\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"可以发现有限十进制小数 \"),a(\"code\",[t._v(\"0.1\")]),t._v(\" 却转化成了无限二进制小数 \"),a(\"code\",[t._v(\"0.00011001100...\")]),t._v(\", 可以看到精度在转化过程中丢失了！\")]),t._v(\" \"),a(\"p\",[t._v(\"能被转化为有限二进制小数的十进制小数的最后一位必然以 5 结尾(因为只有 0.5 * 2 才能变为整数)。所以十进制中一位小数 \"),a(\"code\",[t._v(\"0.1 ~ 0.9\")]),t._v(\" 当中除了 \"),a(\"code\",[t._v(\"0.5\")]),t._v(\" 之外的值在转化成二进制的过程中都丢失了精度。\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"推导-0-1-0-2-为何等于-0-30000000000000004\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#推导-0-1-0-2-为何等于-0-30000000000000004\"}},[t._v(\"#\")]),t._v(\" 推导 0.1 + 0.2 为何等于 0.30000000000000004\")]),t._v(\" \"),a(\"p\",[t._v(\"在 JavaScript 中所有数值都以 IEEE-754 标准的 \"),a(\"code\",[t._v(\"64 bit\")]),t._v(\" 双精度浮点数进行存储的。先来了解下 IEEE-754 标准下的\"),a(\"a\",{attrs:{href:\"https://zh.wikipedia.org/wiki/%E9%9B%99%E7%B2%BE%E5%BA%A6%E6%B5%AE%E9%BB%9E%E6%95%B8\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"双精度浮点数\"),a(\"OutboundLink\")],1),t._v(\"。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"http://with.muyunyun.cn/dda7d5b38676abfa13afb344f8a792ed.jpg-300\",alt:\"\"}})]),t._v(\" \"),a(\"p\",[t._v(\"这幅图很关键, 可以从图中看到 IEEE-754 标准下双精度浮点数由三部分组成, 分别如下:\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[t._v(\"sign(符号): 占 1 bit, 0 表示正, 1 表示负;\")]),t._v(\" \"),a(\"li\",[t._v(\"exponent(指数): 占 11 bit, 表示范围;\")]),t._v(\" \"),a(\"li\",[t._v(\"mantissa(尾数): 占 52 bit, 表示精度, 多出的末尾如果是 1 需要进位;\")])]),t._v(\" \"),a(\"p\",[t._v(\"推荐阅读 \"),a(\"a\",{attrs:{href:\"https://github.com/camsong/blog/issues/9\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"JavaScript 浮点数陷阱及解法\"),a(\"OutboundLink\")],1),t._v(\", 阅读完该文后可以了解到以下公式的由来。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"http://with.muyunyun.cn/5c268e4bd6e0bf2466598d9d5cb58a16.jpg-200\",alt:\"\"}})]),t._v(\" \"),a(\"blockquote\",[a(\"p\",[t._v(\"精度位总共是 53 bit, 因为用科学计数法表示, 所以首位固定的 1 就没有占用空间。即公式中 (M + 1) 里的 1。另外公式里的 1023 是 2^11 的一半。小于 1023 的用来表示小数, 大于 1023 的用来表示整数。\")])]),t._v(\" \"),a(\"blockquote\",[a(\"p\",[t._v(\"指数可以控制到 2^1024 - 1, 而精度最大只达到 2^53 - 1, 两者相比可以得出 JavaScript 实际可以精确表示的数字其实很少。\")])]),t._v(\" \"),a(\"p\",[a(\"code\",[t._v(\"0.1\")]),t._v(\" 转化为二进制为 \"),a(\"code\",[t._v(\"0.0001100110011...\")]),t._v(\", 用科学计数法表示为 \"),a(\"code\",[t._v(\"1.100110011... x 2^(-4)\")]),t._v(\", 根据上述公式, \"),a(\"code\",[t._v(\"S\")]),t._v(\" 为 \"),a(\"code\",[t._v(\"0\")]),t._v(\"(1 bit), \"),a(\"code\",[t._v(\"E\")]),t._v(\" 为 \"),a(\"code\",[t._v(\"-4 + 1023\")]),t._v(\", 对应的二进制为 \"),a(\"code\",[t._v(\"01111111011\")]),t._v(\"(11 bit), \"),a(\"code\",[t._v(\"M\")]),t._v(\" 为 \"),a(\"code\",[t._v(\"1001100110011001100110011001100110011001100110011010\")]),t._v(\"(52 bit, 另外注意末尾的进位), \"),a(\"code\",[t._v(\"0.1\")]),t._v(\" 的存储示意图如下:\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"http://with.muyunyun.cn/5b7c0dcc0b1770b6eed238e288eb4c0e.jpg-300\",alt:\"\"}})]),t._v(\" \"),a(\"p\",[t._v(\"同理, \"),a(\"code\",[t._v(\"0.2\")]),t._v(\" 转化为二进制为 \"),a(\"code\",[t._v(\"0.001100110011...\")]),t._v(\", 用科学计数法表示为 \"),a(\"code\",[t._v(\"1.100110011... x 2^(-3)\")]),t._v(\", 根据上述公式, \"),a(\"code\",[t._v(\"E\")]),t._v(\" 为 \"),a(\"code\",[t._v(\"-3 + 1023\")]),t._v(\", 对应的二进制为 \"),a(\"code\",[t._v(\"01111111100\")]),t._v(\", \"),a(\"code\",[t._v(\"M\")]),t._v(\" 为 \"),a(\"code\",[t._v(\"1001100110011001100110011001100110011001100110011010\")]),t._v(\", \"),a(\"code\",[t._v(\"0.2\")]),t._v(\" 的存储示意图如下:\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"http://with.muyunyun.cn/cb0ef89aa0ed6e8d32b90d1a29cfc9e1.jpg-300\",alt:\"\"}})]),t._v(\" \"),a(\"p\",[a(\"code\",[t._v(\"0.1 + 0.2\")]),t._v(\" 即 2^(-4) x 1.1001100110011001100110011001100110011001100110011010 与 2^(-3) x 1.1001100110011001100110011001100110011001100110011010 之和\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-js extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 计算过程\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.00011001100110011001100110011001100110011001100110011010\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.0011001100110011001100110011001100110011001100110011010\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 相加得\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.01001100110011001100110011001100110011001100110011001110\")]),t._v(\"\\n\")])])]),a(\"p\",[a(\"code\",[t._v(\"0.01001100110011001100110011001100110011001100110011001110\")]),t._v(\" 转化为十进制就是 \"),a(\"code\",[t._v(\"0.30000000000000004\")]),t._v(\"。验证完成!\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"javascript-的最大安全数是如何来的\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#javascript-的最大安全数是如何来的\"}},[t._v(\"#\")]),t._v(\" JavaScript 的最大安全数是如何来的\")]),t._v(\" \"),a(\"p\",[t._v(\"根据双精度浮点数的构成, 精度位数是 \"),a(\"code\",[t._v(\"53 bit\")]),t._v(\"。安全数的意思是在 \"),a(\"code\",[t._v(\"-2^53 ~ 2^53\")]),t._v(\" 内的整数(不包括边界)与唯一的双精度浮点数互相对应。举个例子比较好理解:\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-js extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[a(\"code\",[t._v(\"Math\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"pow\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"53\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"===\")]),t._v(\" Math\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"pow\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"53\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// true\")]),t._v(\"\\n\")])])]),a(\"p\",[a(\"code\",[t._v(\"Math.pow(2, 53)\")]),t._v(\" 竟然与 \"),a(\"code\",[t._v(\"Math.pow(2, 53) + 1\")]),t._v(\" 相等！这是因为 Math.pow(2, 53) + 1 已经超过了尾数的精度限制(53 bit), 在这个例子中 \"),a(\"code\",[t._v(\"Math.pow(2, 53)\")]),t._v(\" 和 \"),a(\"code\",[t._v(\"Math.pow(2, 53) + 1\")]),t._v(\" 对应了同一个双精度浮点数。所以 \"),a(\"code\",[t._v(\"Math.pow(2, 53)\")]),t._v(\" 就不是安全数了。\")]),t._v(\" \"),a(\"blockquote\",[a(\"p\",[t._v(\"最大的安全数为 \"),a(\"code\",[t._v(\"Math.pow(2, 53) - 1\")]),t._v(\", 即 \"),a(\"code\",[t._v(\"9007199254740991\")]),t._v(\"。\")])]),t._v(\" \"),a(\"h3\",{attrs:{id:\"业务中碰到的精度问题以及解决方案\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#业务中碰到的精度问题以及解决方案\"}},[t._v(\"#\")]),t._v(\" 业务中碰到的精度问题以及解决方案\")]),t._v(\" \"),a(\"p\",[t._v(\"了解 JavaScript 精度问题对我们业务有什么帮助呢？举个业务场景: 比如有个订单号后端 Java 同学定义的是 long 类型, 但是当这个订单号转换成 JavaScript 的 Number 类型时候精度会丢失了, 那没有以上知识铺垫那就理解不了精度为什么会丢失。\")]),t._v(\" \"),a(\"p\",[t._v(\"解决方案大致有以下几种:\")]),t._v(\" \"),a(\"p\",[t._v(\"1.针对大数的整数可以考虑使用 BigInt 类型(目前在 \"),a(\"s\",[t._v(\"stage 3\")]),t._v(\" stage4 阶段)；\")]),t._v(\" \"),a(\"p\",[t._v(\"2.使用 \"),a(\"a\",{attrs:{href:\"https://github.com/MikeMcl/bignumber.js\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"bigNumber\"),a(\"OutboundLink\")],1),t._v(\", 它的思想是转化成 string 进行处理, 这种方式对性能有一定影响;\")]),t._v(\" \"),a(\"p\",[t._v(\"3.可以考虑使用 \"),a(\"a\",{attrs:{href:\"https://github.com/dcodeIO/long.js\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"long.js\"),a(\"OutboundLink\")],1),t._v(\", 它的思想是将长度为 64 位的 long 类型值转化成两个精度为 32 位的双精度类型的值。\")]),t._v(\" \"),a(\"p\",[t._v(\"4.针对小数的话可以使用 \"),a(\"a\",{attrs:{href:\"https://github.com/nefe/number-precision\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"number-precision\"),a(\"OutboundLink\")],1),t._v(\", 该库将小数转为整数后再作处理;\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"相关链接\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#相关链接\"}},[t._v(\"#\")]),t._v(\" 相关链接\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[a(\"a\",{attrs:{href:\"http://justjavac.com/codepuzzle/2012/11/11/codepuzzle-float-who-stole-your-accuracy.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"代码之谜系列\"),a(\"OutboundLink\")],1)]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"https://github.com/camsong/blog/issues/9\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"JavaScript 浮点数陷阱及解法\"),a(\"OutboundLink\")],1),t._v(\": 推荐阅读\")]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"https://www.zhihu.com/question/29010688\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"javascript 里最大的安全的整数为什么是 2 的 53 次方减一\"),a(\"OutboundLink\")],1)]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"http://www.binaryconvert.com/convert_double.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"IEEE-754 进制转换图生成\"),a(\"OutboundLink\")],1),t._v(\": 工具\")]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"https://www.sojson.com/hexconvert.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"在线进制转换工具\"),a(\"OutboundLink\")],1),t._v(\": 工具\")])])])}),[],!1,null,null,null);s.default=e.exports}}]);","extractedComments":[]}